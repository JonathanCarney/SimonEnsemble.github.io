<!DOCTYPE html>
<html lang="en">

<head>
    <title>ODE fun with liquid flow into tanks with complicated geometries</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="blog, The Simon Ensemble, The Simon Ensemble, jekyll">
    <meta name="author" content="The Simon Ensemble">
    
    
    

    <meta name="description" content="We derive a dynamic model for the liquid level in a truncated square pyramidal tank when liquid flows in at a rate $q_i$ and is driven out of the tank by hydrostatic pressure.">
    <link href='https://fonts.googleapis.com/css?family=Inconsolata:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/css/main.css">
    <link rel="icon" type="image/ico" href="http://localhost:4000/assets/favicon.ico">
    <link rel="shortcut-icon" type="image/ico" href="http://localhost:4000/assets/favicon.ico">

    <!-- For Facebook -->
    <meta property="og:title" content="ODE fun with liquid flow into tanks with complicated geometries" />
    <meta property="og:image" content="http://localhost:4000/assets/favicon.ico" />
    <meta property="og:description" content="We derive a dynamic model for the liquid level in a truncated square pyramidal tank when liquid flows in at a rate $q_i$ and is driven out of the tank by hydrostatic pressure." />

    <!-- For Twitter -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="ODE fun with liquid flow into tanks with complicated geometries" />
    <meta name="twitter:description" content="We derive a dynamic model for the liquid level in a truncated square pyramidal tank when liquid flows in at a rate $q_i$ and is driven out of the tank by hydrostatic pressure." />
    <meta name="twitter:image" content="http://localhost:4000/assets/favicon.ico" />
</head>


<body>
    <div class="wrapper">
        <div class="navbar container">
    <a id="site-title" class="alignable pull-left" href="http://localhost:4000">The Simon Ensemble</a>
    <ul id="navlist" class="alignable pull-right navbar-ul">
        
        <li class="alignable pull-left navbar-list">
            <a href="http://localhost:4000/ppl">people</a>
            /
        </li>
        
        <li class="alignable pull-left navbar-list">
            <a href="http://localhost:4000/pubs">publications</a>
            /
        </li>
        
        <li class="alignable pull-left navbar-list">
            <a href="http://localhost:4000/software">software</a>
            /
        </li>
        
        <li class="alignable pull-left navbar-list">
            <a href="http://localhost:4000/teaching">teaching</a>
            /
        </li>
        
        <li class="alignable pull-left navbar-list">
            <a href="http://localhost:4000/join">join</a>
            /
        </li>
        
        <li class="alignable pull-left navbar-list">
            <a href="http://localhost:4000/blog">blog</a>
            
        </li>
        
    </ul>
</div>
<div style="clear:both"></div>

<hr>

        <div class="page-title">
            ODE fun with liquid flow into tanks with complicated geometries
        </div>
        <div class="container">
            <div class="content">
                <div class="page-subtitle">
    
        
            <b>[</b>
        
        <a href="/tags/#chemical engineering" title="chemical engineering">chemical engineering</a>
        
            ,
        
    
        
        <a href="/tags/#process dynamics" title="process dynamics">process dynamics</a>
        
            <b>]</b>
        
    
</div>
<br>
<strong>Cory Simon.</strong>
<p>Liquid continuously flows into a truncated square pyramidal tank at a rate $q_i=q_i(t)$ [m$^3$/s]. Hydrostatic pressure drives flow out of the tank through a narrow pipe at its base; via Bernoulli’s equation, the outlet flow rate $q\propto \sqrt{h}$, where $h$ [m] is the liquid level in the tank.</p>

<figure class="centerr">
    <img src="/images/tank_problem/tank_1.png" alt="image" style="width: 50%;" />
</figure>

<p>The goal here is to derive a dynamic model for the liquid level $h=h(t)$ given any input $q_i(t)$. The outlet flow rate then follows as $c\sqrt{h(t)}$. The proportionality constant $c$ is a characteristic of the liquid in the tank and the geometry of the exit line; it can be measured experimentally.</p>

<p>Taking the liquid as incompressible, a mass balance (system boundary: the tank) implies a volume balance:</p>

<p class="centerr">$\dfrac{dV}{dt}=q_i-c\sqrt{h}$</p>

<p>where $V=V(t)$ is the volume of liquid in the tank at time $t$. This differential equation is intuitive if we multiply it by $dt$. Within a differential time window $dt$, we can view $q_i(t)$ and $h(t)$ as constant. In a differential time span $dt$: the amount of liquid that entered the tank is $q_idt$; the amount of liquid that exited the tank is $c\sqrt{h}dt$; the change in volume $dV$ of liquid in the tank within the differential time span $dt$ then must be $(q_i - c\sqrt{h})dt$.</p>

<p>The [agnostic to tank geometry] volume balance as written is not so helpful. It cannot be directly solved since $V$ is coupled to $h$ through the tank geometry, i.e., $V=V(h)$. Consider $q_i$ and $h$ known at a given moment. Then, the volume of liquid in the tank will change by $dV = (q_i - c\sqrt{h})dt$ after a differential time $dt$. But changing the volume will in turn change the liquid level $h$. So, to compute $dV$ at the <em>next</em> time step, we’d need to know how $h$ changed after we incremented the volume by $dV$ in the first step. This is where the tank geometry comes in.</p>

<p>Consider when the liquid level changes by a differential length $dh$. This corresponds to adding a small slice of liquid whose volume is $dV$. We relate $dV$ and $dh$ through the area $A$ of the added slice of liquid from the helicopter view; $dV=Adh$ since, with such a thin slice, the areas of the bottom and top of the slice are the same. Generally, $A=A(h)$, as is the case for our tank geometry since the area from the helicopter view is larger for smaller liquid levels.</p>

<figure class="centerr">
    <img src="/images/tank_problem/helicopterview.png" alt="image" style="width: 50%;" />
</figure>

<p>Therefore, a more helpful volume balance is:</p>

<p class="centerr">$A(h)\dfrac{dh}{dt}=q_i-c\sqrt{h}$</p>

<p>and is well-posed if we can find how the area from a helicopter view varies with $h$ in the tank geometry. This is the key to solving all tank problems of this nature, regardless of the tank geometry. We now impose our particular tank geometry to find $A(h)$ and complete the dynamic, differential equation model for $h(t)$.</p>

<p>A little more about our truncated square pyramidal tank. The view from all four sides is equivalent and is below. Its height is $H$ [m]. The top and bottom base are of length $L_t$ and $L_b$ [m], respectively. All horizontal slices through the tank reveal a square cross-section. This is a <em>right pyramid</em>, meaning that its apex (if it weren’t truncated) is directly above the centroid of its base.</p>

<figure class="centerr">
    <img src="/images/tank_problem/tank_3.png" alt="image" style="width: 30%;" />
</figure>

<p>If we define $w=w(h)$ [m] to be the length of the line that the top of the liquid makes from a side view, then the area is simply $A(h)=[w(h)]^2$.</p>

<figure class="centerr">
    <img src="/images/tank_problem/tank_2.png" alt="image" style="width: 30%;" />
</figure>

<p>We can relate $w$ to the liquid level $h$, height of the tank $H$, and lengths of the bases $L_t$ and $L_b$ if we draw some right triangles. We bring in $L_t$ and write $w=L_t+2\theta$ with $\theta$ depicted below.</p>

<figure class="centerr">
    <img src="/images/tank_problem/tank_4.png" alt="image" style="width: 30%;" />
</figure>

<p>To determine $\theta$, we recognize two similar right triangles. At the bottom base, we decompose $L_b$ into $L_t$ plus $L_b-L_t$; half of the latter must be the base of the largest right triangle we drew. The smaller right triangle has a height of the tank $H$ minus that of the liquid $h$.</p>

<figure class="centerr">
    <img src="/images/tank_problem/tank_5.png" alt="image" style="width: 50%;" />
</figure>

<p>Because the triangles are similar, the ratio of the lengths of their two sides are equal:</p>

<p class="centerr">$\dfrac{\theta}{H-h} = \dfrac{(L_b-L_t)/2}{H},$</p>

<p>allowing us to solve for $\theta$ in terms of the geometric properties of the tank and the liquid level. Since the area is $A=(L_t + 2\theta)^2$, we arrive at:</p>

<p class="centerr">$A(h) = \left[\frac{h}{H} L_t + \left(1-\frac{h}{H}\right)L_b \right]^2$</p>

<p>The expression inside the brackets $[\cdot]^2$ is $w$. Intuitively, $w$ is a linear interpolation between $L_t$ and $L_b$. As $h\rightarrow 0$, $w$ approaches the bottom base height $L_b$. If $h \rightarrow H$, $w$ approaches the top base height $L_t$. [Some clever folks might write this expression directly, without the similar triangle argument.]</p>

<p>Finally, our expression $A(h)$ for the truncated square pyramidal tank completes the dynamic, differential equation model for the liquid level $h$ in the tank:</p>

<p class="centerr">$\left[\frac{h}{H} L_t + \left(1-\frac{h}{H}\right)L_b \right]^2 \dfrac{dh}{dt}= q_i - c\sqrt{h}$</p>

<p>This differential equation is non-linear. The solution $h(t)$ for a given initial condition $h(t=0)$ and input flow scheme $q_i(t)$ can be obtained numerically e.g. through <a href="http://docs.juliadiffeq.org/latest/">DifferentialEquations.jl</a>.</p>

<h2 id="numerical-solution">Numerical solution</h2>

<p>Let’s write code in Julia and use DifferentialEquations.jl to numerically approximate the solution to our tank problem when the tank is initially empty ($h(t=0)=0$) and liquid flows into the tank at a constant rate.</p>

<p>First, we load some packages and define our parameters.</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="k">using</span> <span class="n">DifferentialEquations</span>
<span class="k">using</span> <span class="n">PyPlot</span> <span class="c"># for plotting</span>
<span class="k">using</span> <span class="n">LaTeXStrings</span> <span class="c"># for LaTeX strings in plots</span>

<span class="n">PyPlot</span><span class="o">.</span><span class="n">matplotlib</span><span class="x">[</span><span class="o">:</span><span class="n">style</span><span class="x">][</span><span class="o">:</span><span class="n">use</span><span class="x">](</span><span class="s">"Solarize_Light2"</span><span class="x">)</span> <span class="c"># dope plot style</span>

<span class="c"># specify tank geometry</span>
<span class="n">H</span> <span class="o">=</span> <span class="mf">4.0</span> <span class="c"># tank height, m</span>
<span class="n">Lb</span> <span class="o">=</span> <span class="mf">5.0</span> <span class="c"># bottom base length, m</span>
<span class="n">Lt</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="c"># top base length, m</span>

<span class="c"># specify resistance to flow</span>
<span class="n">c</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c"># awkward units</span>

<span class="c"># inlet flow rate (could be funciton of time)</span>
<span class="n">qᵢ</span> <span class="o">=</span> <span class="mf">1.5</span> <span class="c"># m³/s</span>

<span class="c"># initial liquid level</span>
<span class="n">h₀</span> <span class="o">=</span> <span class="mf">0.0</span> </code></pre></figure>

<p>Second, we use DifferentialEquations.jl to numerically solve the ODE.</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="n">tspan</span> <span class="o">=</span> <span class="x">(</span><span class="mf">0.0</span><span class="x">,</span> <span class="mf">150.0</span><span class="x">)</span> <span class="c"># solve for 0 s to 150 s</span>

<span class="c"># area from a helicopter view, m²</span>
<span class="n">A</span><span class="x">(</span><span class="n">h</span><span class="x">,</span> <span class="n">Lt</span><span class="x">,</span> <span class="n">Lb</span><span class="x">,</span> <span class="n">H</span><span class="x">)</span> <span class="o">=</span> <span class="x">(</span><span class="n">h</span><span class="o">/</span><span class="n">H</span> <span class="o">*</span> <span class="n">Lt</span> <span class="o">+</span> <span class="x">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">h</span><span class="o">/</span><span class="n">H</span><span class="x">)</span> <span class="o">*</span> <span class="n">Lb</span><span class="x">)</span> <span class="o">^</span> <span class="mi">2</span>

<span class="c"># right-hand-side of ODE</span>
<span class="n">rhs</span><span class="x">(</span><span class="n">h</span><span class="x">,</span> <span class="n">p</span><span class="x">,</span> <span class="n">t</span><span class="x">)</span> <span class="o">=</span> <span class="x">(</span><span class="n">qᵢ</span> <span class="o">-</span> <span class="n">c</span> <span class="o">*</span> <span class="n">sqrt</span><span class="x">(</span><span class="n">h</span><span class="x">))</span> <span class="o">/</span> <span class="n">A</span><span class="x">(</span><span class="n">h</span><span class="x">,</span> <span class="n">Lt</span><span class="x">,</span> <span class="n">Lb</span><span class="x">,</span> <span class="n">H</span><span class="x">)</span>

<span class="c"># DifferentialEquations.jl syntax</span>
<span class="n">prob</span> <span class="o">=</span> <span class="n">ODEProblem</span><span class="x">(</span><span class="n">rhs</span><span class="x">,</span> <span class="n">h₀</span><span class="x">,</span> <span class="n">tspan</span><span class="x">)</span>
<span class="n">sol</span> <span class="o">=</span> <span class="n">solve</span><span class="x">(</span><span class="n">prob</span><span class="x">)</span></code></pre></figure>

<p>We next plot the solution.</p>

<figure class="highlight"><pre><code class="language-julia" data-lang="julia"><span class="n">t</span> <span class="o">=</span> <span class="n">range</span><span class="x">(</span><span class="mf">0.0</span><span class="x">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">tspan</span><span class="x">[</span><span class="mi">2</span><span class="x">],</span> <span class="n">length</span><span class="o">=</span><span class="mi">300</span><span class="x">)</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="x">(</span><span class="n">t</span><span class="x">)</span> <span class="c"># easy as that to compute solution at an array of times!</span>

<span class="n">figure</span><span class="x">()</span>
<span class="n">axhline</span><span class="x">(</span><span class="n">y</span><span class="o">=</span><span class="n">H</span><span class="x">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">"--"</span><span class="x">,</span> <span class="n">color</span><span class="o">=</span><span class="s">"k"</span><span class="x">)</span>
<span class="n">xlabel</span><span class="x">(</span><span class="s">L"</span><span class="si">$</span><span class="s">t</span><span class="si">$</span><span class="s">, time [s]"</span><span class="x">)</span>
<span class="n">ylabel</span><span class="x">(</span><span class="s">L"</span><span class="si">$</span><span class="s">h</span><span class="si">$</span><span class="s">, liquid level [m]"</span><span class="x">)</span>
<span class="n">plot</span><span class="x">(</span><span class="n">t</span><span class="x">,</span> <span class="n">h</span><span class="x">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="x">,</span> <span class="n">color</span><span class="o">=</span><span class="s">"orange"</span><span class="x">)</span></code></pre></figure>

<figure class="centerr">
    <img src="/images/tank_problem/numerical_soln.png" alt="image" style="width: 50%;" />
</figure>

<p>The plot above shows the resulting $h(t)$. The horizontal dashed line denotes the tank height $H$. Despite constant flow into the tank, the liquid does not overflow the tank since, if the tank is completely filled ($h=H$), hydrostatic pressure at the bottom drives flow out of the tank faster than the incoming flow rate $q_i$. The liquid level reaches a steady state $\bar{h}$ when the flow rate of liquid into the tank balances the rate at which hydrostatic pressure drives liquid out of the tank:</p>

<p class="centerr">$q_i-c\sqrt{\bar{h}}=0$</p>

<p>Here, with $q_i=1.5$ and $c=1$, the steady state liquid level is $\bar{h}$=2.25 m.</p>


            </div>
            <div class="footer">
                <div class="footer">
    <br><hr>
    <a href="https://simonensemble.github.io" style="color: black">The Simon Ensemble</a>
</div>

            </div>
        </div>
    </div>
</body>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
  });
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
